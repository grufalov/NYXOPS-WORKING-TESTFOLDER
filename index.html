<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' https://*.supabase.co wss://*.supabase.co; object-src 'none'; base-uri 'self';" />
    <title>NyxOps v3</title>
  </head>
  <body>
    <div id="root"></div>
    <div id="global-fallback" style="display:none;position:fixed;inset:auto 1rem 1rem auto;z-index:99999;background:#fee2e2;color:#7f1d1d;border:1px solid #fecaca;border-radius:8px;padding:10px 12px;max-width:380px;font:12px/1.3 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;">
      <div style="font-weight:600;margin-bottom:6px;">App failed to load</div>
      <div id="global-fallback-msg" style="white-space:pre-wrap;opacity:.9;margin-bottom:8px;">An unexpected error prevented the app from starting.</div>
      <div style="display:flex;gap:8px;">
        <button id="global-fallback-reload" style="background:#dc2626;color:#fff;border:none;border-radius:6px;padding:6px 10px;font-size:12px;cursor:pointer;">Reload</button>
        <button id="global-fallback-copy" style="background:#fff;border:1px solid #fecaca;color:#7f1d1d;border-radius:6px;padding:6px 10px;font-size:12px;cursor:pointer;">Copy details</button>
      </div>
    </div>
    <script>
      (function(){
        const fb = document.getElementById('global-fallback');
        const msg = document.getElementById('global-fallback-msg');
        const copyBtn = document.getElementById('global-fallback-copy');
        const reloadBtn = document.getElementById('global-fallback-reload');
        const details = [];
        function showFallback(extra){
          console.log('Global fallback triggered:', extra);
          if(extra){ details.push(String(extra)); }
          if(msg){ msg.textContent = (details.join('\n\n')) || msg.textContent; }
          if(fb){ fb.style.display = 'block'; }
        }
        window.addEventListener('error', (e) => {
          const d = `Error: ${e?.error?.message || e?.message || 'Unknown'}\n${e?.error?.stack || ''}`;
          console.error('Global error caught:', e);
          showFallback(d);
        });
        window.addEventListener('unhandledrejection', (e) => {
          const reason = e?.reason;
          const d = `Unhandled Rejection: ${reason?.message || String(reason)}\n${reason?.stack || ''}`;
          console.error('Unhandled rejection caught:', e);
          showFallback(d);
        });
        // If React hasn't marked ready shortly after load, show fallback
        setTimeout(() => {
          console.log('Checking if app mounted, __NYXOPS_READY__:', window.__NYXOPS_READY__);
          if(!window.__NYXOPS_READY__){
            showFallback('Startup timeout: The app did not mount in time.');
          }
        }, 2500);
        if(reloadBtn){ reloadBtn.onclick = () => location.reload(); }
        if(copyBtn){ copyBtn.onclick = async () => {
          try { await navigator.clipboard.writeText(details.join('\n\n')); copyBtn.textContent = 'Copied!'; setTimeout(()=>copyBtn.textContent='Copy details', 1200); } catch {}
        } }
        console.log('Global fallback script loaded');
      })();
    </script>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
